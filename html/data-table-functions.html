<script>
	function computeAngle($sLat,$sLng,$aLat,$aLng,$iLat,$iLng)
	{
		$alat = $aLat- $sLat;
		$alng = $aLng - $sLng;
		$ilat = $iLat - $sLat;
		$ilng = $iLng - $sLng;
										
		// Comparing the 2 angles if the difference is - then its to the left and if its positive then it is to the right
		$scalar = $alat * $ilat + $alng * $ilng;
		$mag1 = pow(($alat * $alat + $alng * $alng), .5);
		$mag2 = pow(($ilat * $ilat + $ilng * $ilng), .5);
		return round(acos($scalar / ($mag1 * $mag2))*(180/pi()),2);
	}

	function convertGPStoYards($lat1, $lng1, $lat2, $lng2)
	{
		$dlat = ($lat2 - $lat1)*(pi()/180);
		$dlon = ($lng2 - $lng1)*(pi()/180);                          
		$a = pow(sin($dlat / 2), 2) + cos($lat1) * cos($lat2) * pow(sin($dlon / 2), 2);
		$c = 2 * atan2(sqrt($a), sqrt(1 - $a));
		return round(6967420.2 * $c,2);
	}
	function makeDivs($rs)
	{
		for($i =0; $i < count($rs); $i++)
		{
			$rh = $rs[$i]['round']['holes'];
			$str = $str . '
			<div id="tableHoles' . $rh[0]['hole']['id'] . 'div" class="tab2">
				<table cellpadding="0" cellspacing="0" border="0" class="display" id="tableHoles' . $rh[0]['hole']['id'] .'"></table>
			</div>';
			
			for($j =0; $j < count($rh); $j++)
			{
				$ra = $rh[$j]['hole']['shots'];
				$str = $str . '
				<div id="tableShots' . $ra[0]['shot']['id'] . 'div" class="tab2">
					<table cellpadding="0" cellspacing="0" border="0" class="display" id="tableShots' . $ra[0]['shot']['id'] .'"></table>
				</div>';
			}
		}
		return $str;
	}
	function createShot($rs, $cel)
	{
		$data = "";
		$holes = "";
		$cell = "";
		if(count($rs) > 0)
		{
			for($i =0; $i < count($rs); $i++)
			{
				$r = $rs[$i]['shot'];
				$angle = computeAngle($r['startLatitude'],$r['startLongitude'],$r['aimLatitude'],$r['aimLongitude'],$r['endLatitude'],$r['endLongitude']);
				$distance = convertGPStoYards($r['startLatitude'],$r['startLongitude'],$r['endLatitude'],$r['endLongitude']);
				$data = $data . '['.$r['id'] . ',' . $r['holeID'] . ',"' . $r['club'] . '",' . $r['shotNumber'] . ',' . $distance . ',' . $angle . '],';
			}
			$data = substr($data, 0, -1);
			
			$cell = $cel . '#tableShots' . $rs[0]['shot']['id'] . 'div").show(); history[2]="tableShots' . $rs[0]['shot']['id'] . 'div"; });
			cell.css("cursor","pointer");';
			
			$str = '$("#tableShots' . $rs[0]['shot']['id'] . '").dataTable({
					"iDisplayLength": 25,
					"aaData": [' . $data .'],
					"aoColumns": [{
							"sTitle": "Shot Id"
					}, {
							"sTitle": "Hole ID"
					}, {
							"sTitle": "Club"
					}, {
							"sTitle": "Shot Number"
					}, {
							"sTitle": "Distance(yards)"
					}, {
							"sTitle": "Angle (Degrees)"
					}],
					"sDom": \'C<"clear">lfrtip\',
					"oColVis": {
							"activate": "mouseover"
					}});
					$("#tableShots' . $rs[0]['shot']['id'] . 'div").hide();' . "\n" . $cell;
		}
		else
		{
			$str = "";
		}
		return $str;
	}
	function createHole($rs,$cel)
	{
		$data = "";
		$shots = "";
		$cell = "";
		if(count($rs) > 0)
		{
			for($i =0; $i < count($rs); $i++)
			{
				$r = $rs[$i]['hole'];
				$data = $data . '['.$r['id'] . ',' . $r['roundID'] . ',' . $r['holeNumber'] . ',' . $r['putts'] . ',' . count($r['shots']) . '],';
				$cell = 'cell = $($($("#tableHoles' . $rs[0]['hole']['id'] . '").children().eq(1)).children().eq(' . $i . ')).children().eq(0);' . "\n" . 'cell.click(function(){$("#tableHoles' . $rs[0]['hole']['id'] . 'div").hide();$("';
				
				$shots = $shots . createShot($r['shots'],$cell);
			}
			$data = substr($data, 0, -1);
			$cel = $cel . '#tableHoles' . $rs[0]['hole']['id'] . 'div").show();$("#larrow").show(); history[1]="tableHoles' . $rs[0]['hole']['id'] . 'div";});
			cell.css("cursor","pointer");';

			$str = $str . '$("#tableHoles' . $rs[0]['hole']['id'] . '").dataTable({
					"iDisplayLength": 25,
					"aaData": [' . $data .'],
					"aoColumns": [{
							"sTitle": "Hole Id"
					}, {
							"sTitle": "Round ID"
					}, {
							"sTitle": "Hole Number"
					}, {
							"sTitle": "Putts"
					}, {
							"sTitle": "Shots"
					}],
					"sDom": \'C<"clear">lfrtip\',
					"oColVis": {
							"activate": "mouseover"
					}});
					$("#tableHoles' . $rs[0]['hole']['id'] . 'div").hide();' . "\n" . $cel;
		}
		else
		{
			$str = "";
		}        
		return $str . $shots;
	}                           
	function createRound($rs)
	{
		$data = "";
		$holes = "";
		$cell = "";
		for($i =0; $i < count($rs); $i++)
		{
			$r = $rs[$i]['round'];
			$data = $data . '['.$r['id'] . ',' . $r['totalScore'] . ',"' . $r['startTime'] . '",' . $r['teeID'] . '],';
			$cell = 'cell = $($($("#tableRounds").children().eq(1)).children().eq(' . $i . ')).children().eq(0);' . "\n" . 'cell.click(function(){$("#tableRoundsdiv").hide();$("';
			$holes = $holes . createHole($r['holes'],$cell);
		}
		$data = substr($data, 0, -1);
		$str = '$("#tableRounds").dataTable({
				"iDisplayLength": 25,
				"aaData": [' . $data .'],
				"aoColumns": [{
						"sTitle": "Round ID"
				}, {
						"sTitle": "Total Score"
				}, {
						"sTitle": "Round Time"
				}, {
						"sTitle": "Tee ID"
				}],
				"sDom": \'C<"clear">lfrtip\',
				"oColVis": {
						"activate": "mouseover"
				}});';
				
		return $str. $holes;
	}
</script>