<script type="text/javascript">
function convertGPStoYards(lat1, lng1, lat2, lng2)
{
    var dlat = (lat2 - lat1)*(Math.PI/180);
    var dlon = (lng2 - lng1)*(Math.PI/180);                          
    var a = Math.pow(Math.sin(dlat / 2), 2) + Math.cos(lat1) * Math.cos(lat2) * Math.pow(Math.sin(dlon / 2), 2);
    var c = 2 * atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return Math.round(6967420.2 * c, 2);
}
function findClub(array, club)
{
    for(var i = 0; i < array.length; i++)
    {
        if(array[i][0] == club)
            return i;
    }
    return -1;
}
function combineClubs(holes)
{
	var ar = new Array();
	for (var i = 0; i < holes.length; i++)
        {
	    var hole = holes[i];
	
	    if (hole.length > 0)
            {			
                for(var j = 0; j < count(hole); j++)
                {
                    var club = hole[j][0];
					var index = findClub(ar, club);
                    if(index != -1)
                    {
                        var array = ar[index];
                        array[i+1] = hole[j][1];
                        ar[index] = array;
                    }
                    else
                    {
                        var array = [club,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
                        array[i+1] = hole[j][1];
                        array_push(ar, array);
                    }
                }
            }
	}
	return ar;
}
function findGroup(holes)
{
    var clubs = 
		[
            ["Driver", "3 Wood", "4 Wood", "5 Wood", "7 Wood", "9 Wood"], //Triangle
            ["2 Hybrid", "3 Hybrid", "4 Hybrid", "5 Hybrid", "6 Hybrid"], // Square
            ["2 Iron", "3 Iron", "4 Iron", "5 Iron", "6 Iron", "7 Iron","8 Iron", "9 Iron"], // Circle
            ["Pitching Wedge", "Approach Wedge", "Sand Wedge", "Lob Wedge", "High Lob Wedge"] // Diamond
		];
    var str = '';
    var data = '';
    var items = [[],[],[],[]];
    holes = combineClubs(holes);
 
    for (var i = 0; i < holes.length; i++)
    {
        var h = holes[i];
        var found = false;
        
        for (var j = 0; j < 4; j++) 
		{
			var clubIndex = clubs[j];
            for (var k = 0; k < clubIndex.length; k++) {
                if (clubIndex[k] == h[0]) {
                    array_push(items[j], h);
                    found = true;
                    break;
                }
            }

            if (found) {
                break;
            }
        }
    }
    var wood = "var woods = [";
    var hybrid = "var hybrids = [";
    var iron = "var irons = [";
    var wedge = "var wedges = [";

    if(items[0].length > 0)
    {
        for(var c = 0; c < items[0].length; c++)
        {
            var item = items[0][c];
            var data = '';
            for(var d = 1; d < 19; d++)
            {
				data += (item[d] + ',');
            }
            data = data.substr(0, data.length);
            wood += ("{name:\"" + item[0] + "\",data:[" + data + "]},";
        }
        wood = wood.substr(0, wood.length) +']';
    }
    else
    {
        wood += ']';
    }
    if(items[1].length > 0)
    {
        for(var c = 0; c < items[1].length; c++)
        {
            var item = items[1][c];
            var data = '';
            for(var d = 1; d < 19; d++)
            {
				$data += (item[d] + ',');
            }
            data = data.substr(0, data.length);
        }
        hybrid = hybrid.substr(0, hybrid.length) + ']';
    }
    else
    {
        hybrid += ']';
    }
	
    if(items[2].length > 0)
    {
        for(var c = 0; c < items[2].length; c++)
        {
            var item = items[2][c];
            var data = '';
            for(var d = 1; d < 19; d++)
            {
				data += item[d] + ',';
            }
            data = data.substr(0, data.length);
            iron += "{name:\"" + item[0] + "\",data:[" + data + "]},";
        }
        iron = iron.substr(0, iron.length) + "]";
    }
    else
    {
        iron += ']';
    }
	
    if(items[3].length > 0)
    {
        for(var c = 0; c < items[3].length; c++)
        {
            var item = items[3][c];
            var data = '';
            for(var d = 1; d < 19; d++)
            {
				data += item[d] + ',';
            }
            data = data.substr(0, data.length);
            wedge += "{name:\"" + item[0] + "\",data:[" + data + "]},";
        }
        wedge = wedge.substr(0, wedge.length) + ']';
    }
    else
    {
        $wedge += ']';
    }
    return (wood + ";\n" + hybrid + ";\n" + $iron + ";\n" + wedge + ';');
}
function getAllShots(rs)
{
    var holeAr = [
        [],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
        []
    ];
    for (var i = 0; i < rs.length; i++) {
        var r = rs[i]["round"];
        if (r['holes'].length > 0) {
            var rh = r["holes"];
            for (var j = 0; j < rh.length; j++) {
                r = rh[j]["hole"];
                if (r["shots"].length) > 0) {
                    var rc = r["shots"];
                    for (var k = 0; k < rc.length; k++) {
                        r = rc[k]["shot"];
                        var q = holeAr[j];
                        var distance = convertGPStoYards(r["startLatitude"], r["startLongitude"], r["endLatitude"], r["endLongitude"]);
                        club = r["club"];
                        if(distance > 0)
                        {
                            array_push(q, [club, distance]);
                            holeAr[j] = q;
                        }
                    }

                }
            }
        }
    }
    return findGroup(holeAr);
}
</script>

<!--session_start();
if(isset($_SESSION['rounds']))
{  
    $round = $_SESSION['rounds'];
    echo '!-->
	<!DOCTYPE html>
    <html>
		<head>
			<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
			<link rel="stylesheet" type="text/css" href="content/css/menu.css" />
			<link rel="stylesheet" type="text/css" href="content/css/graph.css" />
			<title>Golf Visualizations User</title>
			<script type="text/javascript" src="content/js/jquery1.8.1.js"></script> 
			<script src="js/highcharts.js" type="content/text/javascript"></script>
			<script type="text/javascript" src="content/js/functions.js"></script>
		<script type="application/javascript">

        var chartWood, chartHybrid, chartIron, chartWedge;
        var shots = getAllShots(round); //Needs to be looked into was ". getAllShots($round) ."
                                    
        $(document).ready(function() {
            if(woods.length > 0)
            {
                chartWood = new Highcharts.Chart({
                    chart: {
                        renderTo: "containerWood",
                        type: "column"
                    },
                    title: {
                        text: "Average Distance by Hole for Woods"
                    },
                    xAxis: {
                        categories: [
                            "Hole 1",
                            "Hole 2",
                            "Hole 3",
                            "Hole 4",
                            "Hole 5",
                            "Hole 6",
                            "Hole 7",
                            "Hole 8",
                            "Hole 9",
                            "Hole 10",
                            "Hole 11",
							"Hole 12",
							"Hole 13",
							"Hole 14",
							"Hole 15",
							"Hole 16",
							"Hole 17",
                            "Hole 18"
                        ]
                    },
                    yAxis: {
                        min: 0,
                        title: {
                            text: "Distance (yards)"
                        }
                    },
                    legend: {
                        layout: "vertical",
                        backgroundColor: "#FFFFFF",
                        align: "left",
                        verticalAlign: "top",
                        x: 100,
                        y: 25,
                        floating: true,
                        shadow: true
                    },
                    tooltip: {
                        formatter: function() {
                            return ""+
                                this.x +": "+ this.y + " yards";
                        }
                    },
                    plotOptions: {
                        column: {
                            pointPadding: 0.2,
                            borderWidth: 0
                        }
                    },
                        series: woods
                });
            }
            if(hybrids.length > 0)
            {
                chartHybrid = new Highcharts.Chart({
                    chart: {
                        renderTo: "conainerHybrid",
                        type: "column"
                    },
                    title: {
                        text: "Average Distance by Hole for Hybrids"
                    },
                    xAxis: {
                        categories: [
                            "Hole 1",
                            "Hole 2",
                            "Hole 3",
                            "Hole 4",
                            "Hole 5",
                            "Hole 6",
                            "Hole 7",
                            "Hole 8",
                            "Hole 9",
                            "Hole 10",
                            "Hole 11",
							"Hole 12",
							"Hole 13",
							"Hole 14",
							"Hole 15",
							"Hole 16",
							"Hole 17",
                            "Hole 18"
                        ]
                    },
                    yAxis: {
                        min: 0,
                        title: {
                            text: "Distance (yards)"
                        }
                    },
                    legend: {
                        layout: "vertical",
                        backgroundColor: "#FFFFFF",
                        align: "left",
                        verticalAlign: "top",
                        x: 100,
                        y: 25,
                        floating: true,
                        shadow: true
                    },
                    tooltip: {
                        formatter: function() {
                            return ""+
                                this.x +": "+ this.y +" yards";
                        }
                    },
                    plotOptions: {
                        column: {
                            pointPadding: 0.2,
                            borderWidth: 0
                        }
                    },
                        series: hybrids
                });
           }
           if(irons.length > 0)
           {
                chartIron = new Highcharts.Chart({
                    chart: {
                        renderTo: "containerIron",
                        type: "column"
                    },
                    title: {
                        text: "Average Distance by Hole for Irons"
                    },
                    xAxis: {
                        categories: [
                            "Hole 1",
                            "Hole 2",
                            "Hole 3",
                            "Hole 4",
                            "Hole 5",
                            "Hole 6",
                            "Hole 7",
                            "Hole 8",
                            "Hole 9",
                            "Hole 10",
                            "Hole 11",
							"Hole 12",
							"Hole 13",
							"Hole 14",
							"Hole 15",
							"Hole 16",
							"Hole 17",
                            "Hole 18"
                        ]
                    },
                    yAxis: {
                        min: 0,
                        title: {
                            text: "Distance (yards)"
                        }
                    },
                    legend: {
                        layout: "vertical",
                        backgroundColor: "#FFFFFF",
                        align: "left",
                        verticalAlign: "top",
                        x: 100,
                        y: 25,
                        floating: true,
                        shadow: true
                    },
                    tooltip: {
                        formatter: function() {
                            return ""+
                                this.x +": "+ this.y +" yards";
                        }
                    },
                    plotOptions: {
                        column: {
                            pointPadding: 0.2,
                            borderWidth: 0
                        }
                    },
                        series: irons
                });
            }
            if(wedges.length > 0)
            {
               chartWedge = new Highcharts.Chart({
                    chart: {
                        renderTo: "containerWedge",
                        type: "column"
                    },
                    title: {
                        text: "Average Distance by Hole for Wedges"
                    },
                    xAxis: {
                        categories: [
                            "Hole 1",
                            "Hole 2",
                            "Hole 3",
                            "Hole 4",
                            "Hole 5",
                            "Hole 6",
                            "Hole 7",
                            "Hole 8",
                            "Hole 9",
                            "Hole 10",
                            "Hole 11",
							"Hole 12",
							"Hole 13",
							"Hole 14",
							"Hole 15",
							"Hole 16",
							"Hole 17",
                            "Hole 18"
                        ]
                    },
                    yAxis: {
                        min: 0,
                        title: {
                            text: "Distance (yards)"
                        }
                    },
                    legend: {
                        layout: "vertical",
                        backgroundColor: "#FFFFFF",
                        align: "left",
                        verticalAlign: "top",
                        x: 100,
                        y: 25,
                        floating: true,
                        shadow: true
                    },
                    tooltip: {
                        formatter: function() {
                            return ""+
                                this.x +": "+ this.y +" yards";
                        }
                    },
                    plotOptions: {
                        column: {
                            pointPadding: 0.2,
                            borderWidth: 0
                        }
                    },
                        series: wedges
                });
            }
           $("#containerWood").hide();
           $("#containerHybrid").hide();
           $("#containerIron").hide();
           $("#containerWedge").hide();
        });
        function myToggle(id)
        {
                    if(id == 0)
                    {
                            $("#containerWood").toggle();
                    }
                    else if(id == 1)
                    {
                            $("#containerHybrid").toggle();
                    }
                    else if(id == 2)
                    {
                            $("#containerIron").toggle();
                    }
                    else if(id == 3)
                    {
                            $("#containerWedge").toggle();
                    }
            }
                    </script>
            </head>
            <body>
            <script type="text/javascript">menu();</script>
            <div id="clickWood"><p onclick="myToggle(0);">Click to toggle the Wood Bar Graph</p></div>
            <div id="containerWood"></div>
            <div id="clickHybrid"><p onclick="myToggle(1);">Click to toggle the Hybrid Bar Graph</p></div>
            <div id="containerHybrid"></div>
            <div id="clickIron"><p onclick="myToggle(2);">Click to toggle the Iron bar Graph</p></div>
            <div id="containerIron"></div>
            <div id="clickWedge"><p onclick="myToggle(3);">Click to toggle the Wedge Bar Graph</p></div>
            <div id="containerWedge"></div>
            </body>
    </html>
<!--}
else
{
    echo 'No round data';
    header('Location: index.php');
}
?>!-->
